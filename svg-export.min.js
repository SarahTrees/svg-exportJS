!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):factory((global="undefined"!=typeof globalThis?globalThis:global||self).svgExport=global.svgExport||{})}(this,(function(exports){"use strict";var version="1.0.0",_options={};function setOptions(svg_selector,options){_options={width:100,height:100,scale:1,useCSS:!0,PDFOptions:{customFonts:[],pageLayout:{margin:50,margins:{}},addTitleToPage:!0,chartCaption:"",PDFtextFontFamily:"Helvetica",PDFTitleFontSize:20,PDFCaptionFontSize:14}},options&&options.height?"number"==typeof options.height&&(_options.height=options.height*_options.scale):_options.height=document.querySelector(svg_selector).getBBox().height*_options.scale,options&&options.width?"number"==typeof options.width&&(_options.width=options.width*_options.scale):_options.width=document.querySelector(svg_selector).getBBox().width*_options.scale,options&&options.scale&&"number"==typeof options.scale&&(_options.scale=options.scale),options&&options.useCSS&&"function"!=typeof getComputedStyle?(_options.useCSS=!1,alert("Warning svg-export: this browser is not able to get computed styles")):options&&!1===options.useCSS&&(_options.useCSS=!1),["customFonts","pageLayout","addTitleToPage","chartCaption","PDFtextFontFamily","PDFTitleFontSize","PDFCaptionFontSize"].forEach((function(opt){if(options&&options.PDFOptions&&options.PDFOptions[opt]&&typeof options.PDFOptions[opt]==typeof _options.PDFOptions[opt]){if(""===options.PDFOptions[opt])return;_options.PDFOptions[opt]=options.PDFOptions[opt]}"pageLayout"===opt&&(_options.PDFOptions.pageLayout.margin||(_options.PDFOptions.pageLayout.margin=50),_options.PDFOptions.pageLayout.margins||(_options.PDFOptions.pageLayout.margins={}))})),_options.PDFOptions.pageLayout.margins.top=_options.PDFOptions.pageLayout.margins.top||_options.PDFOptions.pageLayout.margin,_options.PDFOptions.pageLayout.margins.bottom=_options.PDFOptions.pageLayout.margins.bottom||_options.PDFOptions.pageLayout.margin,_options.PDFOptions.pageLayout.margins.left=_options.PDFOptions.pageLayout.margins.left||_options.PDFOptions.pageLayout.margin,_options.PDFOptions.pageLayout.margins.right=_options.PDFOptions.pageLayout.margins.top||_options.PDFOptions.pageLayout.margin,delete _options.PDFOptions.pageLayout.margin,options&&_options.PDFOptions.pageLayout.size||(_options.PDFOptions.pageLayout.size=[_options.width+_options.PDFOptions.pageLayout.margins.left+_options.PDFOptions.pageLayout.margins.right,_options.height+_options.PDFOptions.pageLayout.margins.top+_options.PDFOptions.pageLayout.margins.bottom+(_options.PDFOptions.addTitleToPage?2*_options.PDFOptions.PDFTitleFontSize+10:0)+(""!==_options.PDFOptions.chartCaption?4*_options.PDFOptions.PDFCaptionFontSize+10:0)])}function useCSSfromComputedStyles(element,elementClone){for(var i=0;i<element.children.length;i++)useCSSfromComputedStyles(element.children[i],elementClone.children[i]);for(var compStyles=window.getComputedStyle(element),j=0;j<compStyles.length;j++)-1===["width","height","inline-size","block-size"].indexOf(compStyles[j])&&(elementClone.style[compStyles[j]]=compStyles.getPropertyValue(compStyles[j]))}function getSvg(svg_selector,asString=!0){var svg=document.querySelector(svg_selector).cloneNode(!0);if(_options.useCSS&&useCSSfromComputedStyles(document.querySelector(svg_selector),svg),svg.setAttribute("width",_options.width),svg.setAttribute("height",_options.height),svg.setAttribute("preserveAspectRatio","none"),svg.setAttribute("viewBox","0 0 "+document.querySelector(svg_selector).getBBox().width+" "+document.querySelector(svg_selector).getBBox().height),asString){var serializer,svgString=(new XMLSerializer).serializeToString(svg).replace(/currentColor/g,"black");return svgString.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(svgString=svgString.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),svgString.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)||(svgString=svgString.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')),svgString}return svg}function getCustomFonts(font_urls){for(var promises=[],i=0;i<font_urls.length;i++){var promise=new Promise((resolve,reject)=>{var req=new XMLHttpRequest;req.onreadystatechange=function(){4==req.readyState&&200==req.status&&resolve(req.response)},req.open("GET",font_urls[i],!0),req.responseType="arraybuffer",req.send(null)});promises.push(promise)}return promises}function triggerDownload(uri,name,canvas){if(name=name.replace(/[/\\?%*:|"<>]/g,"_"),navigator.msSaveBlob){for(var binary=decodeURIComponent(uri.split(",")[1]),array=[],mimeString=uri.split(",")[0].split(":")[1].split(";")[0],i=0;i<binary.length;i++)array.push(binary.charCodeAt(i));var blob=null;return blob=null!=canvas?canvas.msToBlob():new Blob([new Uint8Array(array)],{type:mimeString}),navigator.msSaveBlob(blob,name)}var link=document.createElement("a");link.download=name,link.href=uri,document.body.appendChild(link),link.click(),document.body.removeChild(link)}function download_svg(svg_selector,svg_name,options){null==svg_name&&(svg_name="chart"),setOptions(svg_selector,options);var svgString=getSvg(svg_selector),url;svgString='<?xml version="1.0" standalone="no"?>\r\n'+svgString,triggerDownload("data:image/svg+xml;charset=utf-8,"+encodeURIComponent(svgString),svg_name+".svg")}function download_png(svg_selector,svg_name,options){download_raster(svg_selector,svg_name,options,"png")}function download_jpeg(svg_selector,svg_name,options){download_raster(svg_selector,svg_name,options,"jpeg")}function download_raster(svg_selector,svg_name,options,image_type){if("object"==typeof canvg){"png"!==(image_type=image_type.toLowerCase().replace("jpg","jpeg"))&&"jpeg"!==image_type&&(image_type="png"),null==svg_name&&(svg_name="chart");var canvas=document.createElement("canvas");options&&(options.width||options.height)||(_options.scale=10),setOptions(svg_selector,options);var svgString=getSvg(svg_selector);"jpeg"===image_type&&(svgString=svgString.replace(">","><rect x='0' y='0' width='"+_options.width+"' height='"+_options.height+"' fill='white'/>"));var ctx=canvas.getContext("2d"),image;canvg.Canvg.fromString(ctx,svgString).start(),triggerDownload(canvas.toDataURL("image/"+image_type),svg_name+"."+image_type,canvas)}else alert("Error svg-export: PNG/JPEG export requires Canvg.js")}function fillPDFDoc(doc,svg_name,svg){_options.PDFOptions.addTitleToPage&&doc.font(_options.PDFOptions.PDFtextFontFamily).fontSize(_options.PDFOptions.PDFTitleFontSize).text(svg_name,{width:_options.PDFOptions.pageLayout.size[0]-_options.PDFOptions.pageLayout.margins.left-_options.PDFOptions.pageLayout.margins.right}),SVGtoPDF(doc,svg,_options.PDFOptions.pageLayout.margins.left,doc.y+10,{width:_options.width,height:_options.height,preserveAspectRatio:"none",useCSS:_options.useCSS}),""!==_options.PDFOptions.chartCaption&&doc.font(_options.PDFOptions.PDFtextFontFamily).fontSize(_options.PDFOptions.PDFCaptionFontSize).text(_options.PDFOptions.chartCaption,_options.PDFOptions.pageLayout.margins.left,_options.PDFOptions.pageLayout.size[1]-_options.PDFOptions.pageLayout.margins.bottom-4*_options.PDFOptions.PDFCaptionFontSize,{width:_options.PDFOptions.pageLayout.size[0]-_options.PDFOptions.pageLayout.margins.left-_options.PDFOptions.pageLayout.margins.right})}function download_pdf(svg_selector,svg_name,options){if("function"==typeof PDFDocument&&"function"==typeof SVGtoPDF){null==svg_name&&(svg_name="chart"),setOptions(svg_selector,options);var svg=getSvg(svg_selector,!1),doc=new PDFDocument(_options.PDFOptions.pageLayout),stream=doc.pipe(blobStream());if(_options.PDFOptions.customFonts.length>0){var promises=getCustomFonts(_options.PDFOptions.customFonts.map((function(d){return d.url})));Promise.all(promises).then((function(fonts){for(var i=0;i<fonts.length;i++){for(var font_styled_elements=svg.querySelectorAll("[style*='"+_options.PDFOptions.customFonts[i].fontName+"']"),j=0;j<font_styled_elements.length;j++)font_styled_elements[j].style.fontFamily=_options.PDFOptions.customFonts[i].fontName;doc.registerFont(_options.PDFOptions.customFonts[i].fontName,fonts[i],_options.PDFOptions.customFonts[i].styleName)}fillPDFDoc(doc,svg_name,svg),doc.end()}))}else fillPDFDoc(doc,svg_name,svg),doc.end();stream.on("finish",(function(){var url;triggerDownload(stream.toBlobURL("application/pdf"),svg_name+".pdf")}))}else alert("Error svg-export: PDF export requires PDFKit.js and SVG-to-PDFKit")}exports.version="1.0.0",exports.downloadSvg=download_svg,exports.downloadPng=download_png,exports.downloadJpeg=download_jpeg,exports.downloadPdf=download_pdf,Object.defineProperty(exports,"__esModule",{value:!0})}));